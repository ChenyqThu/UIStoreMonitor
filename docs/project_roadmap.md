# UniFi Store Monitor 项目路线图

> 创建时间: 2025-11-21
> 最后更新: 2025-11-21
> 当前版本: v1.0.0
> 目标版本: v2.4.0
> **开发分支: `develop`**
> **稳定分支: `main`**

---

## 重要提醒

```
⚠️  所有 v2.x 开发必须在 develop 分支进行！

# 开始开发前，请确认当前分支
git branch

# 如果不在 develop 分支，请切换
git checkout develop
```

---

## 项目概述

本项目旨在重构 UniFi Store Monitor，解决当前数据采集和展示的局限性，实现：
- 完整的产品变体数据采集
- 折扣信息追踪和展示
- 价格/库存变化监控
- 更丰富的前端展示功能

---

## 版本规划总览

| 版本 | 阶段 | 目标 | 状态 |
|------|------|------|------|
| v2.0.0 | Phase 1 | 数据库重构 + 爬虫更新 | [ ] 待开始 |
| v2.1.0 | Phase 2 | Dashboard 增强 | [ ] 待开始 |
| v2.2.0 | Phase 3 | ProductDetail 重构 | [ ] 待开始 |
| v2.3.0 | Phase 4 | 新增页面 (Deals/Alerts) | [ ] 待开始 |
| v2.4.0 | Phase 5 | 优化完善 | [ ] 待开始 |

---

## Phase 1: v2.0.0 数据库重构 + 爬虫更新

### 目标
重建数据库结构，支持产品变体、折扣信息、标签等完整数据存储。

### 任务清单

| # | 任务 | 状态 | 负责 |
|---|------|------|------|
| 1.1 | 创建新数据库 Schema SQL 文件 | [ ] | - |
| 1.2 | 在 Supabase 执行新表创建 | [ ] | - |
| 1.3 | 重写 crawler.ts 爬虫脚本 | [ ] | - |
| 1.4 | 添加标签解析逻辑 | [ ] | - |
| 1.5 | 添加变体数据采集逻辑 | [ ] | - |
| 1.6 | 添加选项数据采集逻辑 | [ ] | - |
| 1.7 | 添加技术规格采集逻辑 | [ ] | - |
| 1.8 | 添加关联产品采集逻辑 | [ ] | - |
| 1.9 | 运行爬虫测试 | [ ] | - |
| 1.10 | 验证数据完整性 | [ ] | - |
| 1.11 | 更新 storeService.ts | [ ] | - |
| 1.12 | 更新 types.ts 数据模型 | [ ] | - |

### 详细说明

#### 1.1 新数据库 Schema

创建 `supabase_schema_v2.sql`，包含以下表：
- `categories` - 类别表
- `products` - 产品主表 (使用 UUID 主键)
- `product_variants` - 产品变体表 (SKU 级别)
- `product_tags` - 产品标签表
- `product_options` - 产品选项表
- `variant_history` - 变体历史表
- `product_specs` - 技术规格表 (新增)
- `linked_products` - 关联产品表 (新增)

#### 1.3 爬虫重写要点

```
数据采集流程:
1. 获取 buildId
2. 遍历所有类别
3. 对每个产品:
   - 存储产品基本信息 (使用 UUID)
   - 遍历所有变体，存储变体信息
   - 解析并存储标签
   - 存储选项定义
   - 存储技术规格
   - 记录变体历史
```

### 验收标准

- [ ] 所有 8 个类别的产品正确入库
- [ ] 产品数量与 API 返回一致
- [ ] 多变体产品的所有 SKU 都已存储
- [ ] 折扣信息正确记录 (current_price, regular_price, discount_percent)
- [ ] 标签正确解析 (tag_type, tag_value)
- [ ] 选项正确存储 (Color, Length 等)
- [ ] 历史记录正确写入

### 完成日期
- 预计开始: ____
- 预计完成: ____
- 实际完成: ____

---

## Phase 2: v2.1.0 Dashboard 增强

### 目标
增强 Dashboard 页面，添加统计概览、折扣展示、多维筛选功能。

### 任务清单

| # | 任务 | 状态 | 负责 |
|---|------|------|------|
| 2.1 | 创建 StatsOverview 组件 | [ ] | - |
| 2.2 | 创建 StatsCard 通用组件 | [ ] | - |
| 2.3 | 添加统计数据查询 API | [ ] | - |
| 2.4 | 增强 FilterBar 组件 | [ ] | - |
| 2.5 | 创建 QuickFilters 组件 | [ ] | - |
| 2.6 | 更新 ProductTable 显示折扣 | [ ] | - |
| 2.7 | 创建 PriceDisplay 组件 | [ ] | - |
| 2.8 | 创建 DiscountBadge 组件 | [ ] | - |
| 2.9 | 创建 PromoTag 组件 | [ ] | - |
| 2.10 | 更新排序选项 (添加折扣排序) | [ ] | - |
| 2.11 | 集成测试 | [ ] | - |

### 组件规格

#### StatsOverview 统计卡片
```
显示: 总产品数 | 在售 | 缺货 | 打折中 | 新上架(本周)
```

#### FilterBar 筛选栏
```
新增筛选项:
- 库存状态: All / In Stock / Out of Stock
- 折扣状态: All / On Sale / No Discount
```

#### QuickFilters 快捷筛选
```
标签: Black Friday | 有折扣 | 有货 | 新品
```

#### ProductTable 价格列
```
显示逻辑:
- 单变体无折扣: $379
- 单变体有折扣: $179 (was $279) -36%
- 多变体: $2 - $92 (24 SKUs)
```

### 验收标准

- [ ] 统计卡片数据正确
- [ ] 库存筛选正常工作
- [ ] 折扣筛选正常工作
- [ ] 快捷筛选标签可用
- [ ] 折扣产品显示原价和折扣%
- [ ] 多变体产品显示价格区间和 SKU 数量
- [ ] 按折扣排序正常工作

### 完成日期
- 预计开始: ____
- 预计完成: ____
- 实际完成: ____

---

## Phase 3: v2.2.0 ProductDetail 重构

### 目标
重构产品详情页，支持变体选择、变体价格表、折扣历史等功能。

### 任务清单

| # | 任务 | 状态 | 负责 |
|---|------|------|------|
| 3.1 | 更新 getProductDetail API | [ ] | - |
| 3.2 | 创建 VariantSelector 组件 | [ ] | - |
| 3.3 | 创建 VariantTable 组件 | [ ] | - |
| 3.4 | 增强 PriceHistoryChart (支持SKU筛选) | [ ] | - |
| 3.5 | 创建 DiscountHistory 组件 | [ ] | - |
| 3.6 | 创建 ProductFeatures 组件 | [ ] | - |
| 3.7 | 更新 ProductDetail 页面布局 | [ ] | - |
| 3.8 | 添加标签页切换 (价格/库存/折扣/特性) | [ ] | - |
| 3.9 | 集成测试 | [ ] | - |

### 组件规格

#### VariantSelector 变体选择器
```
Props: options[], variants[], selectedVariant, onSelect
功能: 根据选项 (Color/Length) 选择具体变体
显示: 选项按钮组，选中高亮
```

#### VariantTable 变体价格表
```
列: SKU | Option | Price | Regular Price | Discount | Stock
显示: 所有变体的详细信息
```

#### PriceHistoryChart 增强
```
新增: SKU 选择器下拉框
功能: 选择 "All" 显示所有变体，选择具体 SKU 显示单条线
折扣期间: 使用不同颜色标记
```

#### DiscountHistory 折扣历史
```
表格: 日期 | 原价 | 折扣价 | 折扣% | 状态
数据: 从 variant_history 聚合
```

#### ProductFeatures 产品特性
```
分类显示标签:
- 网络特性: 10G SFP+, 2.5 GbE, ...
- 容量: UniFi Devices: 30, ...
- 促销: Black Friday
```

### 验收标准

- [ ] 变体选择器正确联动
- [ ] 选择变体后价格/库存更新
- [ ] 变体表正确显示所有 SKU
- [ ] 价格历史支持按 SKU 筛选
- [ ] 折扣历史正确展示
- [ ] 产品特性正确分类显示

### 完成日期
- 预计开始: ____
- 预计完成: ____
- 实际完成: ____

---

## Phase 4: v2.3.0 新增页面

### 目标
新增 Deals 折扣监控页面和 Alerts 变化提醒页面。

### 任务清单

| # | 任务 | 状态 | 负责 |
|---|------|------|------|
| 4.1 | 创建 DealsPage 页面 | [ ] | - |
| 4.2 | 创建 DealsList 组件 | [ ] | - |
| 4.3 | 创建 DealsStats 组件 | [ ] | - |
| 4.4 | 添加 getDeals API | [ ] | - |
| 4.5 | 创建 AlertsPage 页面 | [ ] | - |
| 4.6 | 创建 PriceChangeList 组件 | [ ] | - |
| 4.7 | 创建 StockChangeList 组件 | [ ] | - |
| 4.8 | 添加变化检测 SQL 查询 | [ ] | - |
| 4.9 | 更新 Navbar 添加导航项 | [ ] | - |
| 4.10 | 更新路由配置 | [ ] | - |
| 4.11 | 集成测试 | [ ] | - |

### 页面规格

#### DealsPage (/deals)
```
内容:
- 折扣统计 (打折产品数, 平均折扣, 最高折扣)
- 折扣产品列表 (按折扣%排序)
- 每项显示: 图片, 名称, SKU, 原价, 折扣价, 折扣%, 库存
```

#### AlertsPage (/alerts)
```
内容:
- 时间范围选择: 24小时 / 7天 / 30天
- 价格变化列表
- 库存变化列表
- 新增折扣列表

检测逻辑: 每日汇总 (对比最近两次爬虫记录)
```

### 验收标准

- [ ] Deals 页正确展示所有打折产品
- [ ] 折扣统计数据正确
- [ ] Alerts 页展示价格变化
- [ ] Alerts 页展示库存变化
- [ ] 时间范围筛选正常工作
- [ ] 导航切换正常

### 完成日期
- 预计开始: ____
- 预计完成: ____
- 实际完成: ____

---

## Phase 5: v2.4.0 优化完善

### 目标
性能优化、UI 细节完善、文档更新、代码清理。

### 任务清单

| # | 任务 | 状态 | 负责 |
|---|------|------|------|
| 5.1 | 分析查询性能 | [ ] | - |
| 5.2 | 添加必要索引 | [ ] | - |
| 5.3 | 优化 API 查询 (分页/懒加载) | [ ] | - |
| 5.4 | UI 细节优化 | [ ] | - |
| 5.5 | 错误处理完善 | [ ] | - |
| 5.6 | 加载状态优化 | [ ] | - |
| 5.7 | 更新 README.md | [ ] | - |
| 5.8 | 更新 API 文档 | [ ] | - |
| 5.9 | 清理旧代码 | [ ] | - |
| 5.10 | 删除旧数据库表 (确认无问题后) | [ ] | - |
| 5.11 | 最终测试 | [ ] | - |

### 验收标准

- [ ] 页面加载时间 < 2s
- [ ] 无控制台错误
- [ ] 所有功能正常
- [ ] 文档完整更新
- [ ] 旧代码已清理

### 完成日期
- 预计开始: ____
- 预计完成: ____
- 实际完成: ____

---

## 技术债务追踪

| 项目 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| - | - | - | - |

---

## 风险与依赖

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| API 结构变化 | 爬虫失效 | 添加错误处理和告警 |
| 数据迁移问题 | 历史数据丢失 | 保留旧表作为备份 |
| 性能问题 | 用户体验差 | 分阶段优化，添加索引 |

---

## 变更日志

| 日期 | 版本 | 变更内容 |
|------|------|----------|
| 2025-11-21 | - | 项目规划文档创建 |

---

## 相关文档

- [数据库重构方案](./database_redesign_proposal.md)
- [前端展示重构方案](./frontend_redesign_proposal.md)
